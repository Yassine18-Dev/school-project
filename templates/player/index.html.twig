{% extends 'base.html.twig' %}

{% block title %}Players{% endblock %}

{% block stylesheets %}
  {{ parent() }}
  {{ include('_ui/am_styles.html.twig') }}
{% endblock %}

{% block body %}
  {% set nextDir = dir == 'asc' ? 'desc' : 'asc' %}

  {% set actions %}
    <a class="am-btn am-btn--primary" href="{{ path('app_player_new') }}">+ New Player</a>
    <a class="am-btn" href="{{ path('app_team_index') }}">Teams</a>
  {% endset %}

  {% set body %}
    <div class="am-toolbar">
      <form method="get" style="display:flex; gap:10px; flex-wrap:wrap; align-items:center;">
        <input class="am-input" type="text" name="q" value="{{ q|default('') }}" placeholder="Rechercher (player ou team)..." />
        <select class="am-select" name="sort">
          <option value="id" {{ sort == 'id' ? 'selected' : '' }}>Tri: ID</option>
          <option value="name" {{ sort == 'name' ? 'selected' : '' }}>Tri: Nom joueur</option>
          <option value="team" {{ sort == 'team' ? 'selected' : '' }}>Tri: Team</option>
        </select>
        <select class="am-select" name="dir">
          <option value="asc" {{ dir == 'asc' ? 'selected' : '' }}>ASC</option>
          <option value="desc" {{ dir == 'desc' ? 'selected' : '' }}>DESC</option>
        </select>

        <button class="am-btn" type="submit">Appliquer</button>

        {% if q or sort != 'id' or dir != 'asc' %}
          <a class="am-btn" href="{{ path('app_player_index') }}">Reset</a>
        {% endif %}
      </form>

      <span class="am-pill">{{ players|length }} résultat(s)</span>
    </div>

    <table class="am-table">
      <thead>
        <tr>
          <th>
            <a class="am-link" href="{{ path('app_player_index', { q: q, sort: 'id', dir: sort == 'id' ? nextDir : 'asc' }) }}">ID</a>
          </th>
          <th>
            <a class="am-link" href="{{ path('app_player_index', { q: q, sort: 'name', dir: sort == 'name' ? nextDir : 'asc' }) }}">Nom</a>
          </th>
          <th>Team</th>
          <th>Photo</th>
          <th class="am-muted">Actions</th>
        </tr>
      </thead>
      <tbody>
        {% for player in players %}
          <tr>
            <td>{{ player.id }}</td>
            <td>{{ player.name }}</td>
            <td>{{ player.team ? player.team.name : '—' }}</td>
            <td>
              {% if player.photo %}
                <img class="am-photo" src="{{ player.photo }}" alt="photo">
              {% else %}
                <span class="am-muted">—</span>
              {% endif %}
            </td>
            <td>
              <a class="am-btn" href="{{ path('app_player_show', {'id': player.id}) }}">Show</a>
              <a class="am-btn" href="{{ path('app_player_edit', {'id': player.id}) }}">Edit</a>
            </td>
          </tr>
        {% else %}
          <tr>
            <td colspan="5" class="am-muted">Aucun joueur trouvé.</td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  {% endset %}

  {{ include('_ui/page_card.html.twig', {
    title: 'Players',
    subtitle: 'Recherche & tri',
    actions: actions,
    body: body
  }) }}
{% endblock %}
